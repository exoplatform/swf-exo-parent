name: Update Submodules
on:
  schedule:
    - cron:  '0 4 * * *' # Everyday at 4 AM UTC
  workflow_dispatch:

jobs:

  update-submodules:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Install SSH key
      uses: shimataro/ssh-key-action@v2
      with:
        key: ${{ secrets.SSH_KEY }}
        known_hosts: ${{ secrets.KNOWN_HOSTS }}
    - name: Fetch Submodules
      run: |
        scripts/clone_all_submodules.sh || :
      env:
        GIT_TOKEN: ${{ secrets.GIT_TOKEN }}

    - name: Commit update
      run: |
        git config --global user.name 'eXo Software Factory'
        git config --global user.email 'exo-swf@exoplatform.com'
        git add -A
        git commit -m "Auto updated submodule references $(date +%d-%m-%Y)" && git push || echo "No changes to commit"
